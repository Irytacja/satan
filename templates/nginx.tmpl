server {
    listen lxc:8080;
    server_name .%%vhost_name%%;

    root %%vhost_path%%/htdocs;
    index index.html index.php;

    # To enable logging uncomment following lines
    # Opening logs have serious impact on I/O performance
    # Use only when really needed
   
    access_log off;
    error_log /dev/null;
    # access_log %%vhost_path%%/logs/nginx-access.log;
    # error_log  %%vhost_path%%/logs/nginx-error.log info;

    # Static files handled by Nginx
    location / {
        try_files $uri $uri/ @proxy;
        expires 1d;
    }

    # PHP support
    location ~ ^(.+\.php)(.*)$ {
        error_page 418 = @proxy;

        # Known security flaws
        location ~ (\..*/.*.php|\0) {
            return 400;
        }

        # I'm a teapot!
        return 418;
    }

    # Proxy to Apache2
    location @proxy {
        internal;
        include /etc/nginx/proxy.conf;
	
	# Cache
	proxy_cache nginx-cache;
	proxy_cache_valid  200 302  5m;
	proxy_cache_valid  404      1m;
	add_header X-Cache-Status $upstream_cache_status;

        proxy_pass http://localhost:8080;
    }
}
